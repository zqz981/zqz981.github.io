--- 
layout: post
titile: 订单流程总结
category: CRM
---

最近阅读订单系统从前端到后端的整个流程，发现订单的创建过程涉及的数据模型转换非常多。在此有心梳理一下订单的全流程处理。
典型的电信业务场景中，用户在客户端选择一个套餐，或者追加选择附属套餐后点击订购即完成一个订单的生成流程。将整个流程掰开来看，整个流程可以分为查询--选择--填充--订购四个阶段。

	1. 查询：用户在浏览器端看到的Offer信息实际上是浏览器向服务器端发送offer查询请求后展示的结果。因此，浏览器首先向Server发起查询请求，获取一组Offer列表供用户选择。在此阶段，Service可以定义为：   List<SimpleOffer> = QueryofferService(keyword)
	注意返回的数据是SimpleOffer，因为Offer信息过多，而查询展示的结果应该是精简的内容，比如OfferId，Description, Offer详细链接等。
	2. 选择：用户选择指定的Offer时，根据OfferId, 应该再向系统发送一起服务请求，获取该Offer的详细信息。在此阶段Service可以定义为： OfferDetail = QueryOfferDetail(offerId).
	在此阶段OfferDetail信息会部分展示在前端页面上。需要注意的是，OfferDetail并不是Offer数据模型的全部，有部分信息可能不会再前端展示出来（例如Offer展示了商品信息，但是对应到后端处理时需要构建的是产品信息，该种关系是不会在客户面前展示的）
	3. 填充：填充过程包括用户信息的填充，邮寄地址，支付信息等订购相关信息的填充。该阶段前端展示模型需要根据后端定义的模型定义进行设计和组装。前端展示的填充模型可能是多个后端模型的集合体，例如用户信息，账户信息，邮寄地址，支付信息等可以看成是多个独立的数据模型。
	4. 订购：订购的流程可进一步细分成以下几步：
		a. 数据模型组装：例如用户模型实例+账户模型实例+支付模型实例+Offer模型实例构建成一个订单报文
		b. 订单校验：订单数据格式的合法性校验，Offer规则的合法性校验（可能存在商品互斥，需要甄别选择的商品是否只能是多选一），库存校验等。
订单生成：订单履行处理，例如商品库存预占，订单模型落库存储等